function [g1, g2, g3, g4] = MSE_f_4users_4antennas(H11, H12, H13, H14, H21, H22, H23, H24, H31, H32, H33, H34, H41, H42, H43, H44, v11, v12, v13, v14, v21, v22, v23, v24, v31, v32, v33, v34, v41, v42, v43, v44, n0)
%update filters by MSE criterion

%MSE
g1h = (H11*v11+H12*v21+H13*v31+H14*v41)'/...
     ( (H11*v11+H12*v21+H13*v31+H14*v41)*(H11*v11+H12*v21+H13*v31+H14*v41)'...
      +(H11*v12+H12*v22+H13*v32+H14*v42)*(H11*v12+H12*v22+H13*v32+H14*v42)'...
      +(H11*v13+H12*v23+H13*v33+H14*v43)*(H11*v13+H12*v23+H13*v33+H14*v43)'...
      +(H11*v14+H12*v24+H13*v34+H14*v44)*(H11*v14+H12*v24+H13*v34+H14*v44)'...
      +n0*eye(4)...
     );

g2h = (H21*v12+H22*v22+H23*v32+H24*v42)'/...
     ( (H21*v11+H22*v21+H23*v31+H24*v41)*(H21*v11+H22*v21+H23*v31+H24*v41)'...
      +(H21*v12+H22*v22+H23*v32+H24*v42)*(H21*v12+H22*v22+H23*v32+H24*v42)'...
      +(H21*v13+H22*v23+H23*v33+H24*v43)*(H21*v13+H22*v23+H23*v33+H24*v43)'...
      +(H21*v14+H22*v24+H23*v34+H24*v44)*(H21*v14+H22*v24+H23*v34+H24*v44)'...
      +n0*eye(4)...
     );
 
g3h = (H31*v13+H32*v23+H33*v33+H34*v43)'/...
     ( (H31*v11+H32*v21+H33*v31+H34*v41)*(H31*v11+H32*v21+H33*v31+H34*v41)'...
      +(H31*v12+H32*v22+H33*v32+H34*v42)*(H31*v12+H32*v22+H33*v32+H34*v42)'...
      +(H31*v13+H32*v23+H33*v33+H34*v43)*(H31*v13+H32*v23+H33*v33+H34*v43)'...
      +(H31*v14+H32*v24+H33*v34+H34*v44)*(H31*v14+H32*v24+H33*v34+H34*v44)'...
      +n0*eye(4)...
     );
 
 g4h = (H41*v14+H42*v24+H43*v34+H44*v44)'/...
     ( (H41*v11+H42*v21+H43*v31+H44*v41)*(H41*v11+H42*v21+H43*v31+H44*v41)'...
      +(H41*v12+H42*v22+H43*v32+H44*v42)*(H41*v12+H42*v22+H43*v32+H44*v42)'...
      +(H41*v13+H42*v23+H43*v33+H44*v43)*(H41*v13+H42*v23+H43*v33+H44*v43)'...
      +(H41*v14+H42*v24+H43*v34+H44*v44)*(H41*v14+H42*v24+H43*v34+H44*v44)'...
      +n0*eye(4)...
     );

g1 = g1h';
g2 = g2h';
g3 = g3h';
g4 = g4h';

%Normalize
%{
if norm(g1)^2 > 1
g1 = g1/norm(g1);
end
if norm(g2)^2 > 1
g2 = g2/norm(g2);
end
if norm(g3)^2 > 1
g3 = g3/norm(g3);
end
%}
end

    
    